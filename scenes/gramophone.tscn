[gd_scene load_steps=16 format=3 uid="uid://cg6lbg7tcacmj"]

[ext_resource type="PackedScene" uid="uid://bgc1qkeq0l76u" path="res://models/gramophone/glb/gramophone.glb" id="1_dylsv"]
[ext_resource type="PackedScene" uid="uid://dkyp2218x3gtw" path="res://scenes/lid.tscn" id="2_grppd"]
[ext_resource type="Script" uid="uid://2tf7rjpyulqi" path="res://scripts/gramophone_controller.gd" id="3_controller"]
[ext_resource type="Script" uid="uid://ctdx28ypg5yqy" path="res://scripts/state_machine.gd" id="4_statemachine"]
[ext_resource type="Script" uid="uid://bsrgq2rfol8ch" path="res://scripts/states/state_intro.gd" id="5_intro"]
[ext_resource type="Script" uid="uid://baojyap7ue40w" path="res://scripts/states/state_lid_closed.gd" id="6_lidclosed"]
[ext_resource type="Script" uid="uid://brfgf6dg6k3yr" path="res://scripts/states/state_lid_open.gd" id="7_lidopen"]
[ext_resource type="Script" uid="uid://dqibycfuhv2lp" path="res://scripts/states/state_crank_picked_up.gd" id="8_crankpickedup"]
[ext_resource type="Script" uid="uid://bff4hmbboka2k" path="res://scripts/states/state_crank_inserted.gd" id="9_crankinserted"]
[ext_resource type="Script" uid="uid://8hkehvk7q0m2" path="res://scripts/simple_pickable.gd" id="11_pickable"]
[ext_resource type="Script" uid="uid://c8ep21m1q6kq7" path="res://scripts/simple_snap_zone.gd" id="13_snapzone"]
[ext_resource type="Shader" uid="uid://bf8r6qih2b0fp" path="res://shaders/outline.gdshader" id="14_outline"]

[sub_resource type="BoxShape3D" id="BoxShape3D_crank"]
size = Vector3(0.25, 0.055, 0.085)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_crank_outline"]
render_priority = 0
shader = ExtResource("14_outline")
shader_parameter/shell_thickness = 0.002
shader_parameter/shell_color = Color(1, 1, 0, 0.2)
shader_parameter/glow_speed = 3.0
shader_parameter/glow_min = 0.7
shader_parameter/glow_max = 1.0

[sub_resource type="SphereShape3D" id="SphereShape3D_snapzone"]
radius = 0.15

[node name="Gramophone" type="Node3D" node_paths=PackedStringArray("state_machine", "lid", "audio_player", "crank_pickable", "mounted_crank_snap_zone", "stashed_crank_snap_zone")]
script = ExtResource("3_controller")
state_machine = NodePath("StateMachine")
lid = NodePath("Lid")
audio_player = NodePath("AudioStreamPlayer3D")
crank_pickable = NodePath("CrankPickable")
mounted_crank_snap_zone = NodePath("MountedCrankSnapZone")
stashed_crank_snap_zone = NodePath("StashedCrankSnapZone")

[node name="StateMachine" type="Node" parent="."]
script = ExtResource("4_statemachine")
initial_state = "Intro"

[node name="Intro" type="Node" parent="StateMachine"]
script = ExtResource("5_intro")

[node name="LidClosed" type="Node" parent="StateMachine"]
script = ExtResource("6_lidclosed")

[node name="LidOpen" type="Node" parent="StateMachine"]
script = ExtResource("7_lidopen")

[node name="CrankPickedUp" type="Node" parent="StateMachine"]
script = ExtResource("8_crankpickedup")

[node name="CrankInserted" type="Node" parent="StateMachine"]
script = ExtResource("9_crankinserted")

[node name="AudioStreamPlayer3D" type="AudioStreamPlayer3D" parent="."]

[node name="Lid" parent="." instance=ExtResource("2_grppd")]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 0.1, 0)

[node name="Base" type="Node3D" parent="."]

[node name="Model" parent="Base" instance=ExtResource("1_dylsv")]

[node name="Lid" parent="Base/Model" index="1"]
visible = false

[node name="Brake" parent="Base/Model" index="2"]
visible = false

[node name="Crank" parent="Base/Model" index="3"]
visible = false

[node name="Filter" parent="Base/Model" index="4"]
visible = false

[node name="Tonearm" parent="Base/Model" index="5"]
visible = false

[node name="CrankPickable" type="RigidBody3D" parent="." node_paths=PackedStringArray("outline") groups=["Cranks"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.10053733, 0.103012174, 0.039805263)
freeze = true
script = ExtResource("11_pickable")
outline = NodePath("Outline")

[node name="CollisionShape3D" type="CollisionShape3D" parent="CrankPickable"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.11542815, 0, 0.032168508)
shape = SubResource("BoxShape3D_crank")

[node name="Model" parent="CrankPickable" instance=ExtResource("1_dylsv")]

[node name="Base" parent="CrankPickable/Model" index="0"]
visible = false

[node name="Lid" parent="CrankPickable/Model" index="1"]
visible = false

[node name="Brake" parent="CrankPickable/Model" index="2"]
visible = false

[node name="Filter" parent="CrankPickable/Model" index="4"]
visible = false

[node name="Tonearm" parent="CrankPickable/Model" index="5"]
visible = false

[node name="Outline" parent="CrankPickable" instance=ExtResource("1_dylsv")]
visible = false

[node name="Base" parent="CrankPickable/Outline" index="0"]
visible = false

[node name="Lid" parent="CrankPickable/Outline" index="1"]
visible = false

[node name="Brake" parent="CrankPickable/Outline" index="2"]
visible = false

[node name="Crank" parent="CrankPickable/Outline" index="3"]
surface_material_override/0 = SubResource("ShaderMaterial_crank_outline")

[node name="Filter" parent="CrankPickable/Outline" index="4"]
visible = false

[node name="Tonearm" parent="CrankPickable/Outline" index="5"]
visible = false

[node name="MountedCrankSnapZone" type="Area3D" parent="." node_paths=PackedStringArray("snap_position")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.15112917, 0.07363949, 0.14668855)
script = ExtResource("13_snapzone")
snap_group = "Cranks"
snap_position = NodePath(".")

[node name="CollisionShape3D" type="CollisionShape3D" parent="MountedCrankSnapZone"]
shape = SubResource("SphereShape3D_snapzone")

[node name="StashedCrankSnapZone" type="Area3D" parent="." node_paths=PackedStringArray("snap_position")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.10053733, 0.103012174, 0.039805263)
script = ExtResource("13_snapzone")
snap_group = "Cranks"
snap_position = NodePath(".")

[node name="CollisionShape3D" type="CollisionShape3D" parent="StashedCrankSnapZone"]
shape = SubResource("SphereShape3D_snapzone")

[editable path="Base/Model"]
[editable path="CrankPickable/Model"]
[editable path="CrankPickable/Outline"]
